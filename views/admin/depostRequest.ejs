<%- include header %><!-- Content Wrapper. Contains page content -->
    <div class="content-wrapper">
        <!-- Content Header (Page header) -->
        <section class="content-header">
            <h1>
                <%= title %>
            </h1>
        </section>
        <!-- Main content -->
        <section class="content container-fluid">
            <div class="row">
                <div class="col-md-12">
                    <div class="box">
                        <!-- /.box-header -->
                        <div class="box-body table-responsive">
                            <table id="example1" class="table table-bordered table-striped">
                                <thead>
                                    <tr>
                                        <th>No</th>
                                        <th>From</th>
                                        <th>To</th>
                                        <th>Type</th>
                                        <th>Amount</th>
                                        <th>Order Id</th>
                                        <th>Date</th>
                                        <th>Accept</th>
                                        <!-- <th>Win Wallet</th> -->
                                        <th>Reject</th>
                                      
                                    </tr>
                                </thead>
                                <tbody>
                                    <% var i=1; for (d of data) {%>
                               
                                        <tr class="gradeX">
                                            <td>
                                                <%= i++ %>
                                            </td>
                                            <td>
                                                <p><span style="color: #788ca8;">Unique Id</span>: <%= d.userId %></p>
                                                <p><span style="color: rgb(207, 72, 72);">Full Name</span>: <%= d.username %></p>
                                                <p><span style="color: #788ca8;">Mobile No</span>: <%= d.userNo %></p>
                                            </td>
                                            <td>
                                                <p><span style="color: #788ca8;">Unique Id</span>: <%= d.childIds %></p>
                                                <p><span style="color: rgb(207, 72, 72);">Full Name</span>: <%= d.childName %></p>
                                                <p><span style="color: #788ca8;">Mobile No</span>: <%= d.childNo %></p>
                                                <p><span style="color: rgb(207, 72, 72);">Rank</span>: <%= d.childRole %></p>
                                            </td>
                                         
                                            <td>
                                                <%if(d.transaction_type==="C"){%>
                                                    <span class="label label-success">Credit</span>
                                                <%}else{%>
                                                    <span class="label label-danger">Debit</span>
                                                <%}%>
                                            </td>
                                            <td>
                                                <span class="label label-success"><%= d.txn_amount%></span>
                                            </td>
                                            <td>
                                                <span class="label label-success"> <%= d.txn_id %></span>
                                               
                                            </td>
                                            <!-- <td>
                                                <%= d.win %>
                                            </td> -->
                                            <% 
                                            function formateDateandTime(date) {
                                                // 7/12/2018 12:25PM
                                                var dat = new Date(date);
                                                var mon = (dat.getMonth() + 1 > 9) ? dat.getMonth() + 1 : "0" + parseInt(dat.getMonth() + parseInt(1));
                                                                
                                                var hours = dat.getHours() % 12;
                                                hours = (hours > 9) ? hours : "0" + hours;
                                    
                                                var minutes = dat.getMinutes();
                                                minutes = (minutes > 9) ? minutes : "0" + minutes;
                                    
                                                var ap = (dat.getHours() >= 12) ? "PM" : "AM";
                                                var day = (dat.getDate() > 9) ? dat.getDate() : "0" + dat.getDate();
                                    
                                                rez = day + "/" + mon + "/" + dat.getFullYear() + " " + hours + ":" + minutes + ap;
                                                return rez;
                                            }
                                            %>
                                            <td>
                                                <%= d.showDate%>
                                            </td>
 
                                                        <td class="actions text-center">
                                                            <button class="col select-rank" onclick="accept('<%= d.txn_id %>',1)" style="background-color: #fff; color: #3c8dbc; border: none;"><i class="fa fa-check"></i></button>
                                                        </td>
                                                        <td class="actions text-center">
                                                            <button class="col select-rank" onclick="accept('<%= d.txn_id %>',0)" style="background-color: #fff; color: #3c8dbc; border: none;"><i class="fa fa-times"></i></button>
                                                        </td>
                                        </tr>
                                        <% }%>
                                </tbody>
                            </table>
                        </div>
                        <!-- /.box-body -->
                    </div>
                </div>
            </div>
        </section>
        <!-- /.content -->
    </div>
    <!-- /.content-wrapper --><%- include footer %>
        <script>
            $(document).ready(function (e) {
                function formateDateandTime(date) {
                    // console.log(data);
                    var dat = new Date(date);
                    var mon =
                        dat.getMonth() + 1 > 9
                            ? dat.getMonth() + 1
                            : "0" + parseInt(dat.getMonth() + parseInt(1));
                    var hours = dat.getHours() % 12;
                    hours = hours > 9 ? hours : "0" + hours;
                    var minutes = dat.getMinutes();
                    minutes = minutes > 9 ? minutes : "0" + minutes;
                    var ap = dat.getHours() >= 12 ? "PM" : "AM";
                    var day = dat.getDate() > 9 ? dat.getDate() : "0" + dat.getDate();
                    rez =
                        day +
                        "/" +
                        mon +
                        "/" +
                        dat.getFullYear() +
                        " " +
                        hours +
                        ":" +
                        minutes +
                        ap;
                    return rez;
                }
                // console.log(data);
                $("#usersTab").DataTable({
                    destroy: true,
                    dom: "lBfrtip",
                    lengthMenu: [
                        [10, 25, 100, 500],
                        [10, 25, 100, 500],
                    ],
                    pageLength: 10,
                    buttons: [
                        {
                            extend: "excel",
                            text: '<span class="fa fa-file-excel-o"></span> Excel Export',
                            exportOptions: {
                                modifier: { search: "applied", order: "applied" },
                                format: {
                                    body: function (data, row, column, node) {
                                        // if (column === 7) {
                                        //     data = data.replace(/<.*?>/gi, "");
                                        // }
                                        // if (column === 8) {
                                        //     data = data.replace(/<.*?>/gi, "");
                                        // }
                                        if (column === 4) {
                                            data = formateDateandTime(parseInt(data));
                                        }
                                        return data;
                                    },
                                },
                            },
                        },
                        {
                            extend: "pdf",
                            text: '<span class="fa fa-file-pdf-o"></span> PDF Export',
                            exportOptions: {
                                modifier: { search: "applied", order: "applied" },
                                format: {
                                    body: function (data, row, column, node) {
                                        // if (column === 7) {
                                        //     data = data.replace(/<.*?>/gi, "");
                                        // }
                                        // if (column === 8) {
                                        //     data = data.replace(/<.*?>/gi, "");
                                        // }
                                        if (column === 4) {
                                            data = formateDateandTime(parseInt(data));
                                        }
                                        return data;
                                    },
                                },
                            },
                        },
                    ],
                    responsive: true,
                    processing: true,
                    serverSide: true,
                    ajax: "/users_ajax",
                    deferLoading: "<%= total %>",
                    aaSorting: [],
                    sortField: 5,
                    sortOrder: "-1",
                    columnDefs: [
                        { orderable: true, targets: [0, 6, 3, 4] },
                        { orderable: false, targets: [1, 2, 7, 8] },
                    ],
                    createdRow: function (row, data, dataIndex) {
        console.log(data[5], dataIndex);
        var rowData =
            "<td>" + data[0] + "</td>" +
            "<td>" + data[1] + "</td>" +
            "<td>" + data[2] + "</td>" +
            "<td>" + data[3] + "</td>" +
            "<td>" + (data[4] ? formateDateandTime(parseInt(data[4])) : '') + "</td>";
        $(row).html(rowData);
    },
                });
                $("#usersTab").DataTable().order([4, "desc"]).draw();
            });

            const accept = (id,type) => {
    

                fetch(`/user/accept-request?rank_id=${id}&type=${type}`, {
                method: "GET",
                headers: {
                    "Content-Type": "application/json",
                },
            })
            .then(response => response.json())
            .then(response => {
                const title = response.status == 1 ? "Success" : "Error";
                swal({
                icon: response.status == 1 ? "success" : "error",
                title: response.Msg
                }).then(() => {
                window.location.reload();
                });
            })
            .catch(error => {
                console.error("Error fetching search ids:", error);
            });
            };
        </script>